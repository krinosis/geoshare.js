var geoshare=function(s,e,t){function l(){Ys.font=Vs,P(0,0,0,Ws.height,"blue"),P(0,0,Ws.width,0,"blue"),P(0,Ws.height,Ws.width,Ws.height,"blue"),P(Ws.width,0,Ws.width,Ws.height,"blue"),Ys.lineWidth=.5,Ws.addEventListener("mousedown",mouse_down_handler,!1),Ws.addEventListener("mousemove",mouse_move_handler,!1),Ws.addEventListener("mouseup",mouse_up_handler,!1)}function i(s){var e=Js(),t=Us();D(e,t,xe),ke.cross_points.push([e,t,xe]),Se.push("cross_points"),Le=!0,de.firstChild.src="src/core/img/undo-active.png",Bs()}function n(s){var e=Js(),t=Us();z(e,t,xe),ke.dot_points.push([e,t,xe]),Se.push("dot_points"),Le=!0,de.firstChild.src="src/core/img/undo-active.png",Bs()}function o(s){var e=Js(),t=Us();j(e,t,"label"),Se.push("labels"),Le=!0,de.firstChild.src="src/core/img/undo-active.png",Bs()}function a(s){Ce=Js(),y1=Us();var e=H(Ce,y1);null!=e&&(Ce=e[0],y1=e[1]),Pe.solid_line_move=!1}function h(s){Ms(),x2=Js(),y2=Us();var e=H(x2,y2);null!=e&&(x2=e[0],y2=e[1],is(e[0],e[1],Ee)),P(Ce,y1,x2,y2,xe),ke.solid_lines.push([Ce,y1,x2,y2,xe]),js&&Ts(),ke.solid_lines.pop()}function c(s){Ms(),Pe.solid_line_move=!0,x2=Js(),y2=Us();var e=H(x2,y2);null!=e&&(x2=e[0],y2=e[1]),Y(Ce,y1,x2,y2)>Ee&&(P(Ce,y1,x2,y2,xe),ke.solid_lines.push([Ce,y1,x2,y2,xe]),Se.push("solid_lines"),Le=!0,de.firstChild.src="src/core/img/undo-active.png",Bs()),Ys.fillText((Y(Ce,y1,x2,y2)/Xs).toFixed(2),x2+5,y2-5),setTimeout(function(){Ms()},1e3),Ce=y1=x2=y2=null}function u(s){Ce=Js(),y1=Us();var e=H(Ce,y1);null!=e&&(Ce=e[0],y1=e[1]),Pe.dashed_line_move=!1}function d(s){Ms(),x2=Js(),y2=Us();var e=H(x2,y2);null!=e&&(x2=e[0],y2=e[1],is(e[0],e[1],Ee)),k(Ce,y1,x2,y2,xe),ke.dashed_lines.push([Ce,y1,x2,y2,xe]),js&&Ts(),ke.dashed_lines.pop()}function _(s){Ms(),Pe.dashed_line_move=!0,x2=Js(),y2=Us();var e=H(x2,y2);null!=e&&(x2=e[0],y2=e[1]),Y(Ce,y1,x2,y2)>Ee&&(k(Ce,y1,x2,y2,xe),ke.dashed_lines.push([Ce,y1,x2,y2,xe]),Se.push("dashed_lines"),Le=!0,de.firstChild.src="src/core/img/undo-active.png",Bs()),Ce=y1=x2=y2=null}function p(s){Ce=Js(),y1=Us();var e=H(Ce,y1);null!=e&&(Ce=e[0],y1=e[1]),Pe.height_move=!1}function y(s){if(!Pe.height_move){Ms(),x2=Js(),y2=Us();var e=Q(Ce,y1,x2,y2);null!=e&&(x2=e[0],y2=e[1],k(e[0],e[1],e[5],e[6],xe)),P(Ce,y1,x2,y2,xe),ke.heights.push([Ce,y1,x2,y2,null,null,null,null,null,null,null,null,null,null,null,null,xe]),js&&Ts(),ke.heights.pop(),ss(Ce,y1,x2,y2)}}function f(s){Ms(),Pe.height_move=!0,x2=Js(),y2=Us();var e=Q(Ce,y1,x2,y2);if(null!=e){x2=e[0],y2=e[1],P(Ce,y1,x2,y2,xe);var t=e[2],l=e[3],r=(Y(t,l,x2,y2),Y(Ce,y1,x2,y2),5);if(Ce!=x2)var i=(y1-y2)/(Ce-x2),n=r/Math.sqrt(1+i*i)*((Ce-x2)/Math.abs(x2-Ce))+x2,o=i*(n-x2)+y2;else var n=x2,o=y2-r*((y2-y1)/Math.abs(y2-y1));if(t!=x2)var i=(l-y2)/(t-x2),a=r/Math.sqrt(1+i*i)*((t-x2)/Math.abs(x2-t))+x2,h=i*(a-x2)+y2;else var a=x2,h=y2-r*((y2-l)/Math.abs(y2-l));var c=(n+a)/2,u=(o+h)/2,d=2*c-x2,_=2*u-y2;P(n,o,d,_),P(a,h,d,_),_top_point=es(Ce,y1);var p=(null!=_top_point?_top_point[3]:"",null!=_top_point?0:null);ke.heights.push([Ce,y1,parseFloat(x2.toFixed(4)),parseFloat(y2.toFixed(4)),parseFloat(n.toFixed(4)),parseFloat(o.toFixed(4)),parseFloat(a.toFixed(4)),parseFloat(h.toFixed(4)),parseFloat(d.toFixed(4)),parseFloat(_.toFixed(4)),_top_point,"",p,null,e[7],e[8],xe]),Se.push("heights"),e[4]&&(k(e[0],e[1],e[5],e[6],xe),ke.dashed_lines.push([e[0],e[1],e[5],e[6],xe]),Le=!0,de.firstChild.src="src/core/img/undo-active.png",Bs())}Ce=y1=x2=y2=null}function v(s){Ce=Js(),y1=Us();var e=H(Ce,y1);null!=e&&(Ce=e[0],y1=e[1]),z(Ce,y1,xe),Pe.circle_move=!1}function m(s){Pe.circle_move||(Ms(),x2=Js(),y2=Us(),z(Ce,y1,xe),J(Ce,y1,Y(Ce,y1,x2,y2),0,2*Math.PI,!1,xe),ke.circles.push([parseFloat(Ce.toFixed(2)),parseFloat(y1.toFixed(2)),parseFloat(Y(Ce,y1,x2,y2).toFixed(2)),xe]),js&&Ts(),ke.circles.pop())}function b(s){Ms(),x2=Js(),y2=Us(),Pe.circle_move=!0,Math.abs(y2-y1)>2||Math.abs(x2-Ce)>2?(z(Ce,y1,xe),J(Ce,y1,Y(Ce,y1,x2,y2),0,2*Math.PI,!1,xe),ke.circles.push([parseFloat(Ce.toFixed(2)),parseFloat(y1.toFixed(2)),parseFloat(Y(Ce,y1,x2,y2).toFixed(2)),xe]),Se.push("circles")):alert("Press, hold & drag the mouse to draw circle"),Ce=y1=x2=y2=null,Le=!0,de.firstChild.src="src/core/img/undo-active.png",Bs()}function x(s){if(Pe.compass_draw&&Pe.compass_rad)Ms(),we=Js(),oy=Us(),z(we,oy,xe);else if(!Pe.compass_rad){Pe.compass_rad=!0,Ce=Js(),y1=Us(),z(we,oy,xe),z(Ce,y1,xe),k(we,oy,Ce,y1,xe),ke.compass.push([xe,[parseFloat(Ce.toFixed(2)),parseFloat(y1.toFixed(2))]]);var e=Ce-we,t=y1-oy;r3=Math.sqrt(e*e+t*t),Pe.compass_draw=!1}}function M(s){var e=Js(),t=Us();Ms(),z(e,t,xe),null!=we&&z(we,oy,xe),as(e,t,e,t)}function C(s){Ce=Js(),y1=Us(),Ms(),Ys.fillStyle="grey",z(we,oy,xe),z(Ce,y1,xe),k(we,oy,Ce,y1,"grey"),Ys.fillText((Y(we,oy,Ce,y1)/Xs).toFixed(2),(we+Ce)/2,(oy+y1)/2),as(we,oy,Ce,y1)}function B(s){Ms(),Ys.fillStyle="grey",x2=Js(),y2=Us(),z(we,oy,xe),Math.abs(x2-Ce)<2*Xs&&Math.abs(y2-y1)<2*Xs?(_snaps=X(x2,y2,we,oy,r3),z(_snaps[0],_snaps[1],xe),P(Ce,y1,_snaps[0],_snaps[1],xe),k(we,oy,_snaps[0],_snaps[1],xe),Ys.fillText((r3/Xs).toFixed(2),(we+_snaps[0])/2,(oy+_snaps[1])/2),(Math.abs(_snaps[0]-Ce)>=Be||Math.abs(_snaps[1]-y1)>=Be)&&(Ce=_snaps[0],y1=_snaps[1],ke.compass[ke.compass.length-1].push([parseFloat(Ce.toFixed(2)),parseFloat(y1.toFixed(2))]),js&&Ts())):(k(we,oy,x2,y2,xe),z(x2,y2,xe)),as(we,oy,Ce,y1)}function S(s){Pe.compass_rad&&Pe.compass_draw?Pe.compass_rad=!1:Pe.compass_draw||(Pe.compass_draw=!0,_snaps=X(x2,y2,we,oy,r3),ke.compass[ke.compass.length-1].push([parseFloat(_snaps[0].toFixed(2)),parseFloat(_snaps[1].toFixed(2))]),we=oy=Ce=y1=x2=y2=r=r2=r3=null,Se.push("compass"),Ys.fillStyle=xe),Le=!0,de.firstChild.src="src/core/img/undo-active.png",Bs()}function I(s){if(we=Js(),oy=Us(),0==ke.ruler.length)ke.ruler=[we,oy,we+(Gs-1)*Xs+10,oy],we=oy=null;else if(null==Fe){var e=Y(ke.ruler[0],ke.ruler[1],ke.ruler[2],ke.ruler[3]);Fe=Y(we,oy,ke.ruler[0],ke.ruler[1])<e/4?"left":Y(we,oy,ke.ruler[2],ke.ruler[3])<e/4?"right":"move"}else Fe=null}function E(s){var e=Js(),t=Us();if(Ms(),0==ke.ruler.length)Fe=null,Ys.drawImage(be,e,t),ke.ruler=[e,t,e+(Gs-1)*Xs+10,t],js&&Ts(),ke.ruler=[];else{var l=Y(ke.ruler[0],ke.ruler[1],ke.ruler[2],ke.ruler[3]);null!=Fe?("left"==Fe?(_snaps=X(e,t,ke.ruler[2],ke.ruler[3],l),ke.ruler[0]=_snaps[0],ke.ruler[1]=_snaps[1]):"right"==Fe?(_snaps=X(e,t,ke.ruler[0],ke.ruler[1],l),ke.ruler[2]=_snaps[0],ke.ruler[3]=_snaps[1]):(ke.ruler=[ke.ruler[0]+=e-we,ke.ruler[1]+=t-oy,ke.ruler[2]+=e-we,ke.ruler[3]+=t-oy],we=e,oy=t),js&&Ts(),Ms()):Y(e,t,ke.ruler[0],ke.ruler[1])<l/4?(Ws.style.cursor="alias",is(ke.ruler[0],ke.ruler[1],l/4)):Y(e,t,ke.ruler[2],ke.ruler[3])<l/4?(Ws.style.cursor="alias",is(ke.ruler[2],ke.ruler[3],l/4)):Ws.style.cursor="move"}}function A(s){Fe=null}function F(s){we=Js(),oy=Us(),0==ke.protr.length?(ke.protr=[we-136,oy,we+136,oy],we=oy=null):Ne=null==Ne?Y(we,oy,ke.protr[0],ke.protr[1])<Ae?"left":Y(we,oy,ke.protr[2],ke.protr[3])<Ae?"right":"move":null}function N(s){var e=Js(),t=Us();Ms(),0==ke.protr.length?(Ne=null,Ys.drawImage(me,e-136,t-137),ke.protr=[e-136,t,e+136,t],js&&Ts(),ke.protr=[]):null!=Ne?("left"==Ne?(_snaps=X(e,t,(ke.protr[0]+ke.protr[2])/2,(ke.protr[1]+ke.protr[3])/2,Y(ke.protr[0],ke.protr[1],ke.protr[2],ke.protr[3])/2),ke.protr=[_snaps[0],_snaps[1],ke.protr[0]+ke.protr[2]-_snaps[0],ke.protr[1]+ke.protr[3]-_snaps[1]]):"right"==Ne?(_snaps=X(e,t,(ke.protr[0]+ke.protr[2])/2,(ke.protr[1]+ke.protr[3])/2,Y(ke.protr[0],ke.protr[1],ke.protr[2],ke.protr[3])/2),ke.protr=[ke.protr[0]+ke.protr[2]-_snaps[0],ke.protr[1]+ke.protr[3]-_snaps[1],_snaps[0],_snaps[1]]):(ke.protr=[ke.protr[0]+=e-we,ke.protr[1]+=t-oy,ke.protr[2]+=e-we,ke.protr[3]+=t-oy],we=e,oy=t),js&&Ts(),Ms()):Y(e,t,ke.protr[0],ke.protr[1])<Ae?(Ws.style.cursor="alias",is(ke.protr[0],ke.protr[1],Ae)):Y(e,t,ke.protr[2],ke.protr[3])<Ae?(Ws.style.cursor="alias",is(ke.protr[2],ke.protr[3],Ae)):Ws.style.cursor="move"}function O(s){Ne=null}function T(s){if(Pe.trans)null==Te?(Ce=Js(),y1=Us(),Pe.select_move=!1,Oe=null):Pe.trans=!1;else{we=Js(),oy=Us();var e=(Ce+x2)/2,t=(y1+y2)/2,l=Math.min(Math.abs(x2-Ce),Math.abs(y2-y1))/5;Te=us(Ce,y1,x2,y2),Y(we,oy,Ce,y1)<l||Y(we,oy,Ce,y2)<l||Y(we,oy,x2,y1)<l||Y(we,oy,x2,y2)<l?Oe="rotate":Y(we,oy,e,y1)<l?Oe="scale-top":Y(we,oy,e,y2)<l?Oe="scale-down":Y(we,oy,Ce,t)<l?Oe="scale-left":Y(we,oy,x2,t)<l?Oe="scale-right":Ce<=we&&we<=x2&&y1<=oy&&oy<=y2?Oe="move":(Pe.trans=!0,Pe.select_move=!0,Ce=x2=y1=y2=null,Te=null,ke.select=[])}}function L(s){if(Pe.select_move||(Ms(),x2=Js(),y2=Us(),ke.select=[Ce,y1,x2,y2],Te=us(Ce,y1,x2,y2)),!Pe.trans){Ms();var e=Js(),t=Us();if(null!=Oe)if("rotate"==Oe){var l=(Ce+x2)/2,r=(y1+y2)/2,i=Math.atan2(oy-r,we-l),n=Math.atan2(t-r,e-l),o=n-i;bs(Te,0,0,null,[o,l,r])}else"scale-left"==Oe?(us(Ce+e-we,y1,x2-(e-we),y2),ke.select=[Ce+e-we,y1,x2-(e-we),y2],bs(Te,e-we,0,[(Ce+x2)/2,null,(Ce+x2)/2-we,null])):"scale-right"==Oe?(us(Ce-(e-we),y1,x2+e-we,y2),ke.select=[Ce-(e-we),y1,x2+e-we,y2],bs(Te,-(e-we),0,[(Ce+x2)/2,null,(Ce+x2)/2-we,null])):"scale-top"==Oe?(us(Ce,y1+t-oy,x2,y2-(t-oy)),ke.select=[Ce,y1+t-oy,x2,y2-(t-oy)],bs(Te,0,t-oy,[null,(y1+y2)/2,null,(y1+y2)/2-oy])):"scale-down"==Oe?(us(Ce,y1-(t-oy),x2,y2+t-oy),ke.select=[Ce,y1-(t-oy),x2,y2+t-oy],bs(Te,0,-(t-oy),[null,(y1+y2)/2,null,(y1+y2)/2-oy])):"move"==Oe&&(us(Ce+e-we,y1+t-oy,x2+e-we,y2+t-oy),ke.select=[Ce+e-we,y1+t-oy,x2+e-we,y2+t-oy],bs(Te,e-we,t-oy,[]));else{var a=Math.min(Math.abs(x2-Ce),Math.abs(y2-y1))/5;Y(e,t,Ce,y1)<a?(Ws.style.cursor="alias",is(Ce,y1,a)):Y(e,t,Ce,y2)<a?(Ws.style.cursor="alias",is(Ce,y2,a)):Y(e,t,x2,y1)<a?(Ws.style.cursor="alias",is(x2,y1,a)):Y(e,t,x2,y2)<a?(Ws.style.cursor="alias",is(x2,y2,a)):Y(e,t,Ce,(y1+y2)/2)<a?(Ws.style.cursor="e-resize",is(Ce,(y1+y2)/2,a)):Y(e,t,(Ce+x2)/2,y1)<a?(Ws.style.cursor="n-resize",is((Ce+x2)/2,y1,a)):Y(e,t,x2,(y1+y2)/2)<a?(Ws.style.cursor="e-resize",is(x2,(y1+y2)/2,a)):Y(e,t,(Ce+x2)/2,y2)<a?(Ws.style.cursor="n-resize",is((Ce+x2)/2,y2,a)):Ce<=e&&e<=x2&&y1<=t&&t<=y2?Ws.style.cursor="move":Ws.style.cursor="default"}}}function R(s){Ms(),Ce=Math.min(ke.select[0],ke.select[2]),y1=Math.min(ke.select[1],ke.select[3]),x2=Math.max(ke.select[0],ke.select[2]),y2=Math.max(ke.select[1],ke.select[3]),cs(Te)?(Pe.del=Pe.copy=!0,ce.firstChild.src="src/core/img/del-passive.png",ue.firstChild.src="src/core/img/copy-passive.png"):(Pe.del=Pe.copy=!1,ce.firstChild.src="src/core/img/del-active.png",ue.firstChild.src="src/core/img/copy-active.png"),Pe.select_move?(Oe=null,null!=Te&&(0!=Se.length&&"trans"!=Se[Se.length-1]&&(ke.trans.push(Te),Se.push("trans")),Te=us(Ce,y1,x2,y2),ke.trans.push(Te),Se.push("trans"))):(Pe.select_move=!0,Pe.trans=!1)}function P(s,e,t,l,r,i){Ys.strokeStyle=r,null!=i&&(Ys.lineWidth=i),Ys.beginPath(),Ys.moveTo(s,e),Ys.lineTo(t,l),Ys.closePath(),Ys.stroke(),Ys.lineWidth=1}function k(s,e,t,l,r){Ys.beginPath(),Ys.strokeStyle=r;var i=t-s,n=l-e,o=Math.atan2(n,i),a=s,h=e;Ys.moveTo(s,e);for(var c=0,u=!0;!(i<0?a<=t:a>=t)||!(n<0?h<=l:h>=l);){var d=Me[c++%Me.length],_=a+Math.cos(o)*d;a=i<0?Math.max(t,_):Math.min(t,_);var p=h+Math.sin(o)*d;h=n<0?Math.max(l,p):Math.min(l,p),u?Ys.lineTo(a,h):Ys.moveTo(a,h),u=!u}Ys.closePath(),Ys.stroke()}function D(s,e,t){P(s-3,e-3,s+3,e+3,t),P(s+3,e-3,s-3,e+3,t)}function z(s,e,t){Ys.strokeStyle=t,Ys.beginPath(),Ys.arc(s,e,1,0,2*Math.PI,!0),Ys.stroke()}function J(s,e,t,l,r,i,n){Ys.strokeStyle=n,Ys.beginPath(),Ys.arc(s,e,t,l,r,i),Ys.stroke()}function U(){var s=navigator.userAgent.toLowerCase();return s.indexOf("chrome")>-1?"chrome":s.indexOf("firefox")>-1?"firefox":s.indexOf("opera")>-1?"opera":s.indexOf("msie")>-1?"ie":s.indexOf("safari")>-1?"safari":void 0}function K(s,e){ve.style.display="inline",ve.value="",ve.style.width="65px",ve.style.height="20px",ve.style.position="absolute",ve.style.top=event.pageY-20+"px",ve.style.left=event.pageX+"px",ve.focus()}function j(s,e,t){K(s,e),ve.onkeypress=function(l){if(13==l.keyCode)switch(ve.style.display="none",t){case"label":W(s,e,ve.value,xe),ke.labels.push([s,e,ve.value,xe]),G(s,e,ve.value)}js&&Ts()}}function G(s,e,t){for(var l=50,r=-1,i=null,n=0;n<ke.heights.length;n++)Y(ke.heights[n][0],ke.heights[n][1],s,e)<l&&(l=Y(ke.heights[n][2],ke.heights[n][3],s,e),r=n,i="top"),Y(ke.heights[n][2],ke.heights[n][3],s,e)<l&&(l=Y(ke.heights[n][2],ke.heights[n][3],s,e),r=n,i="base");r!=-1&&("top"==i?(null==ke.heights[r][12]||l<ke.heights[r][12])&&(ke.heights[r][12]=l,ke.heights[r][10]=t):"base"==i&&(null==ke.heights[r][13]||l<ke.heights[r][13])&&(ke.heights[r][13]=l,ke.heights[r][11]=t))}function W(s,e,t,l){Ys.fillStyle=l,Ys.fillText(t,s+2,e-2)}function Y(s,e,t,l){return Math.sqrt(Math.pow(t-s,2)+Math.pow(l-e,2))}function H(s,e){if(0==Object.size(De))return V(s,e,ke);var t=V(s,e,ke);if(null==t)return V(s,e,De);var l=V(s,e,De);return null==l?t:l}function X(s,e,t,l,r){var i,n,o=s-t,a=e-l;return _r2=Math.sqrt(o*o+a*a),i=o>0?t+r/_r2*Math.abs(o):t-r/_r2*Math.abs(o),n=a>0?l+r/_r2*Math.abs(a):l-r/_r2*Math.abs(a),[i,n]}function V(s,e,t){for(var l=t.cross_points.concat(t.dot_points),r=0;r<l.length;r++)if(Y(s,e,l[r][0],l[r][1])<Ee)return l[r];for(var i=t.circles,r=0;r<i.length;r++)if(Y(s,e,i[r][0],i[r][1])<Ee)return[i[r][0],i[r][1]];for(var n=t.solid_lines.concat(t.dashed_lines,t.heights),r=0;r<n.length;r++){if(Y(s,e,n[r][0],n[r][1])<Ee)return[n[r][0],n[r][1]];if(Y(s,e,n[r][2],n[r][3])<Ee)return[n[r][2],n[r][3]]}return null}function Q(s,e,t,l){if(0==Object.size(De))return Z(s,e,ke,t,l,"user");var r=Z(s,e,ke,t,l,"user");if(null==r)return Z(s,e,De,t,l,"author");var i=Z(s,e,De,t,l,"author");return null==i?r:i}function Z(s,e,t,l,r,i){"user"==i?_lines=t.solid_lines.concat(t.dashed_lines):_lines=t.solid_lines.concat(t.dashed_lines,t.heights);for(var n=0;n<_lines.length;n++){if(_xB=_lines[n][0],_yB=_lines[n][1],_xC=_lines[n][2],_yC=_lines[n][3],_yB==_yC)h=s,c=_yB;else if(_xB==_xC)h=_xB,c=e;else var o=(_yC-_yB)/(_xC-_xB),a=_yB-o*_xB,h=(e+s/o-a)/(o+1/o),c=o*(e+s/o-a)/(o+1/o)+a;if(Y(l,r,h,c)<Ee){var u=!1;return _xB<_xC?h<_xB?u=!0:h>_xC&&(u=!0):_xB>_xC?h>_xB?u=!0:h<_xC&&(u=!0):_yB<_yC&&(_yC<c||_yB>c)?u=!0:_yB>_yC&&(_yC>c||c>_yB)&&(u=!0),Y(_xB,_yB,h,c)>Y(_xC,_yC,h,c)?[h,c,_xB,_yB,u,_xC,_yC,es(_xB,_yB),es(_xC,_yC)]:[h,c,_xC,_yC,u,_xB,_yB,es(_xB,_yB),es(_xC,_yC)]}}return null}function ss(s,e,t,l){var r,i,n=50;if(0!=Object.size(De.solid_lines))for(var o=0;o<De.solid_lines.length;o++){_xB=De.solid_lines[o][0],_yB=De.solid_lines[o][1],_xC=De.solid_lines[o][2],_yC=De.solid_lines[o][3];var a=ts(s,e,_xB,_yB,_xC,_yC);Y(t,l,a[0],a[1])<n&&(r=a[0],i=a[1],n=Y(t,l,a[0],a[1]))}if(0!=Object.size(De.dashed_lines))for(var o=0;o<De.dashed_lines.length;o++){_xB=De.dashed_lines[o][0],_yB=De.dashed_lines[o][1],_xC=De.dashed_lines[o][2],_yC=De.dashed_lines[o][3];var a=ts(s,e,_xB,_yB,_xC,_yC);Y(t,l,a[0],a[1])<n&&(r=a[0],i=a[1],n=Y(t,l,a[0],a[1]))}if(0!=Object.size(De.heights))for(var o=0;o<De.heights.length;o++){_xB=De.heights[o][0],_yB=De.heights[o][1],_xC=De.heights[o][2],_yC=De.heights[o][3];var a=ts(s,e,_xB,_yB,_xC,_yC);Y(t,l,a[0],a[1])<n&&(r=a[0],i=a[1],n=Y(t,l,a[0],a[1]))}for(var o=0;o<ke.solid_lines.length;o++){_xB=ke.solid_lines[o][0],_yB=ke.solid_lines[o][1],_xC=ke.solid_lines[o][2],_yC=ke.solid_lines[o][3];var a=ts(s,e,_xB,_yB,_xC,_yC);Y(t,l,a[0],a[1])<n&&(r=a[0],i=a[1],n=Y(t,l,a[0],a[1]))}for(var o=0;o<ke.dashed_lines.length;o++){_xB=ke.dashed_lines[o][0],_yB=ke.dashed_lines[o][1],_xC=ke.dashed_lines[o][2],_yC=ke.dashed_lines[o][3];var a=ts(s,e,_xB,_yB,_xC,_yC);Y(t,l,a[0],a[1])<n&&(r=a[0],i=a[1],n=Y(t,l,a[0],a[1]))}is(r,i,Ee)}function es(s,e){var t=ke.labels;0!=Object.size(De)&&(t=t.concat(De.labels));for(var l=50,r=-1,i=0;i<t.length;i++)Y(s,e,t[i][0],t[i][1])<l&&(l=Y(s,e,t[i][0],t[i][1]),r=i);return r!=-1?t[r][2]:""}function ts(s,e,t,l,r,i){if(l==i)a=s,h=l;else if(t==r)a=t,h=e;else var n=(i-l)/(r-t),o=l-n*t,a=(e+s/n-o)/(n+1/n),h=n*(e+s/n-o)/(n+1/n)+o;return[a,h]}function ls(s){z(s[0],s[1],"red"),J(s[0],s[1],s[2],0,2*Math.PI,!1,"red")}function rs(s){W(s[0],s[1],s[2],"red")}function is(s,e,t){J(s,e,t,0,2*Math.PI,!1,"red"),z(s,e,"red")}function ns(s,e,t,l,r){is(s,e,Ee),is(t,l,Ee),P(s,e,t,l,"red")}function os(s){for(var e=s[1][0],t=s[1][1],l=2;l<s.length;l++){var r=s[l][0],i=s[l][1];P(e,t,r,i,"red"),e=r,t=i}}function as(s,e,t,l){var r=(s+t)/2,i=(e+l)/2,n=Re;if(s!=t&&e!=l){var o=(l-e)/(t-s),a=Y(s,e,t,l),h=Math.sqrt(n*n-a*a/4),c=r+h/Math.sqrt(1+1/(o*o)),u=i+-1/o*(c-r);l>e&&(u=2*i-u,c=2*r-c);var d=X(c,u,r,i,h+Hs),_=X(t,l,r,i,a/2+Hs),p=X(s,e,r,i,a/2+Hs),g=X(_[0],_[1],c,u,4*n/5),y=X(p[0],p[1],c,u,4*n/5),f=X(t,l,c,u,9*n/10),v=X(s,e,c,u,9*n/10)}else if(s==t&&e==l){var c=s,u=e-n,d=[s,u-Hs],g=[s-Hs,e-2*Hs],y=[s+Hs,e-2*Hs],f=X(s,e,c,u,9*n/10),v=X(s,e,c,u,9*n/10);P(y[0],y[1],s,e,"grey")}else if(e==l){var o=(l-e)/(t-s),a=Y(s,e,t,l),h=Math.sqrt(n*n-a*a/4),c=r,u=i-h;t>s&&(u=2*i-u,c=2*r-c);var d=X(c,u,r,i,h+Hs),_=X(t,l,r,i,a/2+Hs),p=X(s,e,r,i,a/2+Hs),g=X(_[0],_[1],c,u,4*n/5),y=X(p[0],p[1],c,u,4*n/5),f=X(t,l,c,u,9*n/10),v=X(s,e,c,u,9*n/10)}else if(s==t){var a=Y(s,e,t,l),h=Math.sqrt(n*n-a*a/4),c=r+h,u=i;l>e&&(u=2*i-u,c=2*r-c);var d=X(c,u,r,i,h+Hs),_=X(t,l,r,i,a/2+Hs),p=X(s,e,r,i,a/2+Hs),g=X(_[0],_[1],c,u,4*n/5),y=X(p[0],p[1],c,u,4*n/5),f=X(t,l,c,u,9*n/10),v=X(s,e,c,u,9*n/10)}var m=X(g[0],g[1],t,l,Xs),b=X(g[0],g[1],t,l,Hs),x=X(g[0],g[1],t,l,4*Hs/5),M=X(g[0],g[1],t,l,3*Hs/5),C=X(g[0],g[1],t,l,2*Hs/5),w=X(g[0],g[1],t,l,1*Hs/5);P(d[0],d[1],c,u,"black",5),P(f[0],f[1],c,u,"#5ABA47"),P(v[0],v[1],c,u,"#5ABA47"),P(g[0],g[1],c,u,"#5ABA47"),P(y[0],y[1],c,u,"#5ABA47"),P(g[0],g[1],f[0],f[1],"#5ABA47"),P(y[0],y[1],v[0],v[1],"#5ABA47"),P(s,e,v[0],v[1],"grey"),P(m[0],m[1],b[0],b[1],"brown","4"),P(x[0],x[1],M[0],M[1],"brown","3"),P(M[0],M[1],C[0],C[1],"brown","2"),P(C[0],C[1],w[0],w[1],"brown","1"),P(w[0],w[1],t,l,"brown")}function hs(s){for(var e=[],t=0;t<s.length;t++)e[t]=s[t];return e}function cs(s){if(null!=s){for(var e=0;e<s.user.dot_points.length;e++)if(s.user.dot_points[e].length>0)return!1;for(var e=0;e<s.user.cross_points.length;e++)if(s.user.cross_points[e].length>0)return!1;for(var e=0;e<s.user.solid_lines.length;e++)if(s.user.solid_lines[e].length>0)return!1;for(var e=0;e<s.user.dashed_lines.length;e++)if(s.user.dashed_lines[e].length>0)return!1;for(var e=0;e<s.user.circles.length;e++)if(s.user.circles[e].length>0)return!1;for(var e=0;e<s.user.labels.length;e++)if(s.user.labels[e].length>0)return!1;for(var e=0;e<s.user.heights.length;e++)if(s.user.heights[e].length>0)return!1;for(var e=0;e<s.user.compass.length;e++)if(s.user.compass[e].length>0)return!1;for(var e=0;e<s.author.dot_points.length;e++)if(s.author.dot_points[e].length>0)return!1;for(var e=0;e<s.author.cross_points.length;e++)if(s.author.cross_points[e].length>0)return!1;for(var e=0;e<s.author.solid_lines.length;e++)if(s.author.solid_lines[e].length>0)return!1;for(var e=0;e<s.author.dashed_lines.length;e++)if(s.author.dashed_lines[e].length>0)return!1;for(var e=0;e<s.author.circles.length;e++)if(s.author.circles[e].length>0)return!1;for(var e=0;e<s.author.labels.length;e++)if(s.author.labels[e].length>0)return!1;for(var e=0;e<s.author.heights.length;e++)if(s.author.heights[e].length>0)return!1;for(var e=0;e<s.author.compass.length;e++)if(s.author.compass[e].length>0)return!1}return!0}function us(s,e,t,l){var r={user:{dot_points:[],cross_points:[],solid_lines:[],dashed_lines:[],circles:[],labels:[],heights:[],compass:[]},author:{dot_points:[],cross_points:[],solid_lines:[],dashed_lines:[],circles:[],labels:[],heights:[],compass:[]}};return r.user=ds(ke,r.user,s,e,t,l),r.author=ds(De,r.author,s,e,t,l),r}function ds(s,e,t,l,r,i){if(null!=s.dot_points)for(var n=0;n<s.dot_points.length;n++)e.dot_points[n]=[],ys(t,l,r,i,s.dot_points[n])&&(is(s.dot_points[n][0],s.dot_points[n][1],Ee),e.dot_points[n]=hs(s.dot_points[n]));if(null!=s.cross_points)for(var n=0;n<s.cross_points.length;n++)e.cross_points[n]=[],ys(t,l,r,i,s.cross_points[n])&&(is(s.cross_points[n][0],s.cross_points[n][1],Ee),e.cross_points[n]=hs(s.cross_points[n]));if(null!=s.solid_lines)for(var n=0;n<s.solid_lines.length;n++)e.solid_lines[n]=[],gs(t,l,r,i,s.solid_lines[n])&&(ns(s.solid_lines[n][0],s.solid_lines[n][1],s.solid_lines[n][2],s.solid_lines[n][3],Ee),e.solid_lines[n]=hs(s.solid_lines[n]));if(null!=s.dashed_lines)for(var n=0;n<s.dashed_lines.length;n++)e.dashed_lines[n]=[],gs(t,l,r,i,s.dashed_lines[n])&&(ns(s.dashed_lines[n][0],s.dashed_lines[n][1],s.dashed_lines[n][2],s.dashed_lines[n][3],Ee),e.dashed_lines[n]=hs(s.dashed_lines[n]));if(null!=s.circles)for(var n=0;n<s.circles.length;n++)e.circles[n]=[],ps(t,l,r,i,s.circles[n])&&(ls(s.circles[n]),e.circles[n]=hs(s.circles[n]));if(null!=s.labels)for(var n=0;n<s.labels.length;n++)e.labels[n]=[],ys(t,l,r,i,s.labels[n])&&(rs(s.labels[n]),e.labels[n]=hs(s.labels[n]));if(null!=s.heights)for(var n=0;n<s.heights.length;n++)e.heights[n]=[],gs(t,l,r,i,s.heights[n])&&(ns(s.heights[n][0],s.heights[n][1],s.heights[n][2],s.heights[n][3],Ee),e.heights[n]=hs(s.heights[n]));if(null!=s.compass)for(var n=0;n<s.compass.length;n++)e.compass[n]=[],_s(t,l,r,i,s.compass[n])&&(os(s.compass[n]),e.compass[n]=hs(JSON.parse(JSON.stringify(s.compass[n]))));return e}function _s(s,e,t,l,r){for(var i=r[1][0],n=r[1][1],o=2;o<r.length;o++){var a=r[o][0],h=r[o][1],c=[i,n,a,h];if(gs(s,e,t,l,c))return!0;i=a,n=h}return!1}function ps(s,e,t,l,r){var i=r[0],n=r[1],o=r[2];return(s<=i&&i<=t||t<=i&&i<=s)&&(e<=n&&n<=l||l<=n&&n<=e)||(Y(i,n,s,e)<o||Y(i,n,s,l)<o||Y(i,n,t,e)<o||Y(i,n,t,l)<o||(Math.min(Math.abs(i-s),Math.abs(i-t))<o&&(e<=n&&n<=l||l<=n&&n<=e)||Math.min(Math.abs(n-e),Math.abs(n-l))<o&&(s<=i&&i<=t||t<=i&&i<=s)))}function gs(s,e,t,l,r){if(_xA=r[0],_yA=r[1],_xB=r[2],_yB=r[3],Math.max(_xA,_xB)<Math.min(s,t)||Math.min(_xA,_xB)>Math.max(s,t)||Math.max(_yA,_yB)<Math.min(e,l)||Math.min(_yA,_yB)>Math.max(e,l))return!1;if(_xA!=_xB){var i=(_yA-_yB)/(_xA-_xB),n=(_xA*_yB-_xB*_yA)/(_xA-_xB),o=i*s+n,a=i*t+n;if(e<=o&&o<=l||l<=o&&o<=e||e<=a&&a<=l||l<=a&&a<=e)return!0;var h=(e-n)/i,c=(l-n)/i;if(s<=h&&h<=t||t<=h&&h<=s||s<=c&&c<=t||t<=c&&c<=s)return!0}else if(e<=_yA&&_yA<=l||e<=_yB&&_yB<=l)return!0;return!1}function ys(s,e,t,l,r){var i=r[0],n=r[1];return(s<=i&&i<=t||t<=i&&i<=s)&&(e<=n&&n<=l||l<=n&&n<=e)}function fs(s){4==s.length?(k(s[0],s[1],s[0],s[3],"green"),k(s[0],s[1],s[2],s[1],"green"),k(s[0],s[3],s[2],s[3],"green"),k(s[2],s[1],s[2],s[3],"green")):(k(s[0],s[1],s[4],s[5],"green"),k(s[0],s[1],s[6],s[7],"green"),k(s[2],s[3],s[4],s[5],"green"),k(s[2],s[3],s[6],s[7],"green"))}function vs(s,e,t,l,r,i,n){var o=Math.atan2(r-t,l-e),a=o+s,h=Y(e,t,l,r),c=1,u=(c-e)*Math.tan(a)+t,d=X(c,u,e,t,h);return Y(i,n,d[0],d[1])<Ee?d:[2*e-d[0],2*t-d[1]]}function ms(s,e){for(var t=0;t<s.user.dot_points.length;t++)s.user.dot_points[t].length>0&&(s.user.dot_points[t][0]-=e[0],s.user.dot_points[t][1]-=e[1],ke.dot_points.push(s.user.dot_points[t]),Se.push("dot_points"));for(var t=0;t<s.user.cross_points.length;t++)s.user.cross_points[t].length>0&&(s.user.cross_points[t][0]-=e[0],s.user.cross_points[t][1]-=e[1],ke.cross_points.push(s.user.cross_points[t]),Se.push("cross_points"));for(var t=0;t<s.user.labels.length;t++)s.user.labels[t].length>0&&(s.user.labels[t][0]-=e[0],s.user.labels[t][1]-=e[1],ke.labels.push(s.user.labels[t]),Se.push("labels"));for(var t=0;t<s.user.solid_lines.length;t++)s.user.solid_lines[t].length>0&&(s.user.solid_lines[t][0]-=e[0],s.user.solid_lines[t][1]-=e[1],s.user.solid_lines[t][2]-=e[0],s.user.solid_lines[t][3]-=e[1],ke.solid_lines.push(s.user.solid_lines[t]),Se.push("solid_lines"));for(var t=0;t<s.user.dashed_lines.length;t++)s.user.dashed_lines[t].length>0&&(s.user.dashed_lines[t][0]-=e[0],s.user.dashed_lines[t][1]-=e[1],s.user.dashed_lines[t][2]-=e[0],s.user.dashed_lines[t][3]-=e[1],ke.dashed_lines.push(s.user.dashed_lines[t]),Se.push("dashed_lines"));for(var t=0;t<s.user.heights.length;t++)s.user.heights[t].length>0&&(s.user.heights[t][0]-=e[0],s.user.heights[t][1]-=e[1],s.user.heights[t][2]-=e[0],s.user.heights[t][3]-=e[1],s.user.heights[t][4]-=e[0],s.user.heights[t][5]-=e[1],s.user.heights[t][6]-=e[0],s.user.heights[t][7]-=e[1],s.user.heights[t][8]-=e[0],s.user.heights[t][9]-=e[1],ke.heights.push(s.user.heights[t]),Se.push("heights"));for(var t=0;t<s.user.circles.length;t++)s.user.circles[t].length>0&&(s.user.circles[t][0]-=e[0],s.user.circles[t][1]-=e[1],ke.circles.push(s.user.circles[t]),Se.push("circles"));for(var t=0;t<s.user.compass.length;t++)if(s.user.compass[t].length>0){for(var l=1;l<s.user.compass[t].length;l++)s.user.compass[t][l][0]-=e[0],s.user.compass[t][l][1]-=e[1];ke.compass.push(s.user.compass[t]),Se.push("compass")}}function bs(s,e,t,l,r){if(null!=e||null!=t||null!=l)xs(ke,s.user,e,t,l,r),xs(De,s.author,e,t,l,r);else{for(var i=0;i<s.user.dot_points.length;i++)s.user.dot_points[i].length>0&&(ke.dot_points[i][0]=-1,ke.dot_points[i][1]=-1);for(var i=0;i<s.user.cross_points.length;i++)s.user.cross_points[i].length>0&&(ke.cross_points[i][0]=-1,ke.cross_points[i][1]=-1);for(var i=0;i<s.user.labels.length;i++)s.user.labels[i].length>0&&(ke.labels[i][0]=-1,ke.labels[i][1]=-1);for(var i=0;i<s.user.solid_lines.length;i++)s.user.solid_lines[i].length>0&&(ke.solid_lines[i][0]=-1,ke.solid_lines[i][1]=-1,ke.solid_lines[i][2]=-1,ke.solid_lines[i][3]=-1);for(var i=0;i<s.user.dashed_lines.length;i++)s.user.dashed_lines[i].length>0&&(ke.dashed_lines[i][0]=-1,ke.dashed_lines[i][1]=-1,ke.dashed_lines[i][2]=-1,ke.dashed_lines[i][3]=-1);for(var i=0;i<s.user.heights.length;i++)s.user.heights[i].length>0&&(ke.heights[i][0]=-1,ke.heights[i][1]=-1,ke.heights[i][2]=-1,ke.heights[i][3]=-1,ke.heights[i][4]=-1,ke.heights[i][5]=-1,ke.heights[i][6]=-1,ke.heights[i][7]=-1,ke.heights[i][8]=-1,ke.heights[i][9]=-1);for(var i=0;i<s.user.circles.length;i++)s.user.circles[i].length>0&&(ke.circles[i][0]=-1,ke.circles[i][1]=-1,ke.circles[i][2]=0);for(var i=0;i<s.user.compass.length;i++)s.user.compass[i].length>0&&(ke.compass[i]=[])}}function xs(s,e,t,l,r,i){for(var n=0;n<e.dot_points.length;n++)if(e.dot_points[n].length>0)if(null!=i)_rotate_points=vs(i[0],i[1],i[2],e.dot_points[n][0],e.dot_points[n][1],s.dot_points[n][0],s.dot_points[n][1]),s.dot_points[n][0]=_rotate_points[0],s.dot_points[n][1]=_rotate_points[1];else if(0==r.length)s.dot_points[n][0]=e.dot_points[n][0]+t,s.dot_points[n][1]=e.dot_points[n][1]+l;else if(null!=r[0]){var o=(r[0]-e.dot_points[n][0])/Math.abs(r[0]-e.dot_points[n][0]),a=Math.abs(e.dot_points[n][0]-r[0])*t/Math.abs(r[2]);s.dot_points[n][0]=e.dot_points[n][0]+o*a}else if(null!=r[1]){var o=(r[1]-e.dot_points[n][1])/Math.abs(r[1]-e.dot_points[n][1]),a=Math.abs(e.dot_points[n][1]-r[1])*l/Math.abs(r[3]);s.dot_points[n][1]=e.dot_points[n][1]+o*a}for(var n=0;n<e.cross_points.length;n++)if(e.cross_points[n].length>0)if(null!=i)_rotate_points=vs(i[0],i[1],i[2],e.cross_points[n][0],e.cross_points[n][1],s.cross_points[n][0],s.cross_points[n][1]),s.cross_points[n][0]=_rotate_points[0],s.cross_points[n][1]=_rotate_points[1];else if(0==r.length)s.cross_points[n][0]=e.cross_points[n][0]+t,s.cross_points[n][1]=e.cross_points[n][1]+l;else if(null!=r[0]){var o=(r[0]-e.cross_points[n][0])/Math.abs(r[0]-e.cross_points[n][0]),a=Math.abs(e.cross_points[n][0]-r[0])*t/Math.abs(r[2]);s.cross_points[n][0]=e.cross_points[n][0]+o*a}else if(null!=r[1]){var o=(r[1]-e.cross_points[n][1])/Math.abs(r[1]-e.cross_points[n][1]),a=Math.abs(e.cross_points[n][1]-r[1])*l/Math.abs(r[3]);s.cross_points[n][1]=e.cross_points[n][1]+o*a}for(var n=0;n<e.labels.length;n++)if(e.labels[n].length>0)if(null!=i)_rotate_points=vs(i[0],i[1],i[2],e.labels[n][0],e.labels[n][1],s.labels[n][0],s.labels[n][1]),s.labels[n][0]=_rotate_points[0],s.labels[n][1]=_rotate_points[1];else if(0==r.length)s.labels[n][0]=e.labels[n][0]+t,s.labels[n][1]=e.labels[n][1]+l;else if(null!=r[0]){var o=(r[0]-e.labels[n][0])/Math.abs(r[0]-e.labels[n][0]),a=Math.abs(e.labels[n][0]-r[0])*t/Math.abs(r[2]);s.labels[n][0]=e.labels[n][0]+o*a}else if(null!=r[1]){var o=(r[1]-e.labels[n][1])/Math.abs(r[1]-e.labels[n][1]),a=Math.abs(e.labels[n][1]-r[1])*l/Math.abs(r[3]);s.labels[n][1]=e.labels[n][1]+o*a}for(var n=0;n<e.solid_lines.length;n++)if(e.solid_lines[n].length>0)if(null!=i)_rotate_points=vs(i[0],i[1],i[2],e.solid_lines[n][0],e.solid_lines[n][1],s.solid_lines[n][0],s.solid_lines[n][1]),s.solid_lines[n][0]=_rotate_points[0],s.solid_lines[n][1]=_rotate_points[1],_rotate_points=vs(i[0],i[1],i[2],e.solid_lines[n][2],e.solid_lines[n][3],s.solid_lines[n][2],s.solid_lines[n][3]),s.solid_lines[n][2]=_rotate_points[0],s.solid_lines[n][3]=_rotate_points[1];else if(0==r.length)s.solid_lines[n][0]=e.solid_lines[n][0]+t,s.solid_lines[n][1]=e.solid_lines[n][1]+l,s.solid_lines[n][2]=e.solid_lines[n][2]+t,s.solid_lines[n][3]=e.solid_lines[n][3]+l;else if(null!=r[0]){var o=(r[0]-e.solid_lines[n][0])/Math.abs(r[0]-e.solid_lines[n][0]),a=Math.abs(e.solid_lines[n][0]-r[0])*t/Math.abs(r[2]);s.solid_lines[n][0]=e.solid_lines[n][0]+o*a;var o=(r[0]-e.solid_lines[n][2])/Math.abs(r[0]-e.solid_lines[n][2]),a=Math.abs(e.solid_lines[n][2]-r[0])*t/Math.abs(r[2]);s.solid_lines[n][2]=e.solid_lines[n][2]+o*a}else if(null!=r[1]){var o=(r[1]-e.solid_lines[n][1])/Math.abs(r[1]-e.solid_lines[n][1]),a=Math.abs(e.solid_lines[n][1]-r[1])*l/Math.abs(r[3]);s.solid_lines[n][1]=e.solid_lines[n][1]+o*a;var o=(r[1]-e.solid_lines[n][3])/Math.abs(r[1]-e.solid_lines[n][3]),a=Math.abs(e.solid_lines[n][3]-r[1])*l/Math.abs(r[3]);s.solid_lines[n][3]=e.solid_lines[n][3]+o*a}for(var n=0;n<e.dashed_lines.length;n++)if(e.dashed_lines[n].length>0)if(null!=i)_rotate_points=vs(i[0],i[1],i[2],e.dashed_lines[n][0],e.dashed_lines[n][1],s.dashed_lines[n][0],s.dashed_lines[n][1]),s.dashed_lines[n][0]=_rotate_points[0],s.dashed_lines[n][1]=_rotate_points[1],_rotate_points=vs(i[0],i[1],i[2],e.dashed_lines[n][2],e.dashed_lines[n][3],s.dashed_lines[n][2],s.dashed_lines[n][3]),s.dashed_lines[n][2]=_rotate_points[0],s.dashed_lines[n][3]=_rotate_points[1];else if(0==r.length)s.dashed_lines[n][0]=e.dashed_lines[n][0]+t,s.dashed_lines[n][1]=e.dashed_lines[n][1]+l,s.dashed_lines[n][2]=e.dashed_lines[n][2]+t,s.dashed_lines[n][3]=e.dashed_lines[n][3]+l;else if(null!=r[0]){var o=(r[0]-e.dashed_lines[n][0])/Math.abs(r[0]-e.dashed_lines[n][0]),a=Math.abs(e.dashed_lines[n][0]-r[0])*t/Math.abs(r[2]);s.dashed_lines[n][0]=e.dashed_lines[n][0]+o*a;var o=(r[0]-e.dashed_lines[n][2])/Math.abs(r[0]-e.dashed_lines[n][2]),a=Math.abs(e.dashed_lines[n][2]-r[0])*t/Math.abs(r[2]);s.dashed_lines[n][2]=e.dashed_lines[n][2]+o*a}else if(null!=r[1]){var o=(r[1]-e.dashed_lines[n][1])/Math.abs(r[1]-e.dashed_lines[n][1]),a=Math.abs(e.dashed_lines[n][1]-r[1])*l/Math.abs(r[3]);s.dashed_lines[n][1]=e.dashed_lines[n][1]+o*a;var o=(r[1]-e.dashed_lines[n][3])/Math.abs(r[1]-e.dashed_lines[n][3]),a=Math.abs(e.dashed_lines[n][3]-r[1])*l/Math.abs(r[3]);s.dashed_lines[n][3]=e.dashed_lines[n][3]+o*a}for(var n=0;n<e.heights.length;n++)if(e.heights[n].length>0)if(null!=i)_rotate_points=vs(i[0],i[1],i[2],e.heights[n][0],e.heights[n][1],s.heights[n][0],s.heights[n][1]),s.heights[n][0]=_rotate_points[0],s.heights[n][1]=_rotate_points[1],_rotate_points=vs(i[0],i[1],i[2],e.heights[n][2],e.heights[n][3],s.heights[n][2],s.heights[n][3]),s.heights[n][2]=_rotate_points[0],s.heights[n][3]=_rotate_points[1],_rotate_points=vs(i[0],i[1],i[2],e.heights[n][4],e.heights[n][5],s.heights[n][4],s.heights[n][5]),s.heights[n][4]=_rotate_points[0],s.heights[n][5]=_rotate_points[1],_rotate_points=vs(i[0],i[1],i[2],e.heights[n][6],e.heights[n][7],s.heights[n][6],s.heights[n][7]),s.heights[n][6]=_rotate_points[0],s.heights[n][7]=_rotate_points[1],_rotate_points=vs(i[0],i[1],i[2],e.heights[n][8],e.heights[n][9],s.heights[n][8],s.heights[n][9]),s.heights[n][8]=_rotate_points[0],s.heights[n][9]=_rotate_points[1];else if(0==r.length)s.heights[n][0]=e.heights[n][0]+t,s.heights[n][1]=e.heights[n][1]+l,s.heights[n][2]=e.heights[n][2]+t,s.heights[n][3]=e.heights[n][3]+l,s.heights[n][4]=e.heights[n][4]+t,s.heights[n][5]=e.heights[n][5]+l,s.heights[n][6]=e.heights[n][6]+t,s.heights[n][7]=e.heights[n][7]+l,s.heights[n][8]=e.heights[n][8]+t,s.heights[n][9]=e.heights[n][9]+l;else if(null!=r[0]){var o=(r[0]-e.heights[n][0])/Math.abs(r[0]-e.heights[n][0]),a=Math.abs(e.heights[n][0]-r[0])*t/Math.abs(r[2]);s.heights[n][0]=e.heights[n][0]+o*a;var o=(r[0]-e.heights[n][2])/Math.abs(r[0]-e.heights[n][2]),a=Math.abs(e.heights[n][2]-r[0])*t/Math.abs(r[2]);
s.heights[n][2]=e.heights[n][2]+o*a;var o=(r[0]-e.heights[n][4])/Math.abs(r[0]-e.heights[n][4]),a=Math.abs(e.heights[n][4]-r[0])*t/Math.abs(r[2]);s.heights[n][4]=e.heights[n][4]+o*a;var o=(r[0]-e.heights[n][6])/Math.abs(r[0]-e.heights[n][6]),a=Math.abs(e.heights[n][6]-r[0])*t/Math.abs(r[2]);s.heights[n][6]=e.heights[n][6]+o*a;var o=(r[0]-e.heights[n][8])/Math.abs(r[0]-e.heights[n][8]),a=Math.abs(e.heights[n][8]-r[0])*t/Math.abs(r[2]);s.heights[n][8]=e.heights[n][8]+o*a}else if(null!=r[1]){var o=(r[1]-e.heights[n][1])/Math.abs(r[1]-e.heights[n][1]),a=Math.abs(e.heights[n][1]-r[1])*l/Math.abs(r[3]);s.heights[n][1]=e.heights[n][1]+o*a;var o=(r[1]-e.heights[n][3])/Math.abs(r[1]-e.heights[n][3]),a=Math.abs(e.heights[n][3]-r[1])*l/Math.abs(r[3]);s.heights[n][3]=e.heights[n][3]+o*a;var o=(r[1]-e.heights[n][5])/Math.abs(r[1]-e.heights[n][5]),a=Math.abs(e.heights[n][5]-r[1])*l/Math.abs(r[3]);s.heights[n][5]=e.heights[n][5]+o*a;var o=(r[1]-e.heights[n][7])/Math.abs(r[1]-e.heights[n][7]),a=Math.abs(e.heights[n][7]-r[1])*l/Math.abs(r[3]);s.heights[n][7]=e.heights[n][7]+o*a;var o=(r[1]-e.heights[n][9])/Math.abs(r[1]-e.heights[n][9]),a=Math.abs(e.heights[n][9]-r[1])*l/Math.abs(r[3]);s.heights[n][9]=e.heights[n][9]+o*a}for(var n=0;n<e.circles.length;n++)if(e.circles[n].length>0)if(null!=i)_rotate_points=vs(i[0],i[1],i[2],e.circles[n][0],e.circles[n][1],s.circles[n][0],s.circles[n][1]),s.circles[n][0]=_rotate_points[0],s.circles[n][1]=_rotate_points[1];else if(0==r.length)s.circles[n][0]=e.circles[n][0]+t,s.circles[n][1]=e.circles[n][1]+l,s.circles[n][2]=e.circles[n][2];else if(null!=r[0]){var o=(r[0]-e.circles[n][0])/Math.abs(r[0]-e.circles[n][0]),a=Math.abs(e.circles[n][0]-r[0])*t/Math.abs(r[2]);s.circles[n][0]=e.circles[n][0]+o*a}else if(null!=r[1]){var o=(r[1]-e.circles[n][1])/Math.abs(r[1]-e.circles[n][1]),a=Math.abs(e.circles[n][1]-r[1])*l/Math.abs(r[3]);s.circles[n][1]=e.circles[n][1]+o*a}for(var n=0;n<e.compass.length;n++)if(e.compass[n].length>0)if(s.compass[n][0]=e.compass[n][0],null!=i)for(var h=1;h<e.compass[n].length;h++)_rotate_points=vs(i[0],i[1],i[2],e.compass[n][h][0],e.compass[n][h][1],s.compass[n][h][0],s.compass[n][h][1]),s.compass[n][h][0]=_rotate_points[0],s.compass[n][h][1]=_rotate_points[1];else if(0==r.length)for(var h=1;h<e.compass[n].length;h++)s.compass[n][h]=[],s.compass[n][h][0]=e.compass[n][h][0]+t,s.compass[n][h][1]=e.compass[n][h][1]+l;else if(null!=r[0])for(var h=1;h<e.compass[n].length;h++){var o=(r[0]-e.compass[n][h][0])/Math.abs(r[0]-e.compass[n][h][0]),a=Math.abs(e.compass[n][h][0]-r[0])*t/Math.abs(r[2]);s.compass[n][h][0]=e.compass[n][h][0]+o*a}else if(null!=r[1])for(var h=1;h<e.compass[n].length;h++){var o=(r[1]-e.compass[n][h][1])/Math.abs(r[1]-e.compass[n][h][1]),a=Math.abs(e.compass[n][h][1]-r[1])*l/Math.abs(r[3]);s.compass[n][h][1]=e.compass[n][h][1]+o*a}}function Ms(){Ys.clearRect(0,0,Ws.width,Ws.height),Es()}function Cs(s){Pe.cross=!0,Pe.dot=!0,Pe.solid_line=!0,Pe.solid_line_move=!0,Pe.dashed_line=!0,Pe.dashed_line_move=!0,Pe.label=!0,Pe.circle=!0,Pe.circle_move=!0,Pe.compass=!0,Pe.compass_rad=!0,Pe.compass_draw=!0,Pe.ruler=!0,Pe.protr=!0,Pe.height=!0,Pe.height_move=!0,Pe.select=!0,Pe.select_move=!0,Pe.trans=!0,Pe.del=!0,Pe.copy=!0,Ce=x2=y1=y2=null,Te=null;for(var e=0;e<s.length;e++)Pe[s[e]]=!1}function ws(s){null!=s?(ke.cross_points=null!=s.x?s.x:[],ke.dot_points=null!=s.d?s.d:[],ke.solid_lines=null!=s.s?s.s:[],ke.dashed_lines=null!=s.i?s.i:[],ke.circles=null!=s.o?s.o:[],ke.compass=null!=s.v?s.v:[],ke.labels=null!=s.l?s.l:[],ke.ruler=null!=s.r?s.r:[],ke.protr=null!=s.p?s.p:[],ke.heights=null!=s.hg?s.hg:[],Se=null!=s.u?s.u:[]):(ke.cross_points=[],ke.dot_points=[],ke.solid_lines=[],ke.dashed_lines=[],ke.circles=[],ke.compass=[],ke.labels=[],ke.ruler=[],ke.protr=[],ke.heights=[],Se=[]),Bs()}function Bs(){ze.cross_points=[],ze.dot_points=[],ze.solid_lines=[],ze.dashed_lines=[],ze.circles=[],ze.compass=[],ze.labels=[],ze.ruler=[],ze.protr=[],ze.heights=[],Ie=[],_e.firstChild.src="src/core/img/redo-passive.png",ke.select=[],ke.trans=[],ke.del=[],ze.trans=[],ze.del=[]}function Ss(s){null!=s&&(De.cross_points=null!=s.x?s.x:[],De.dot_points=null!=s.d?s.d:[],De.solid_lines=null!=s.s?s.s:[],De.dashed_lines=null!=s.i?s.i:[],De.circles=null!=s.o?s.o:[],De.compass=null!=s.v?s.v:[],De.labels=null!=s.l?s.l:[],De.ruler=null!=s.r?s.r:[],De.protractor=null!=s.p?s.p:[],De.heights=null!=s.hg?s.hg:[],xe="black")}function Is(s){ke[s]=[];for(var e=0;e<Se.length;e++)Se[e]==s&&(Se.splice(e,1),e--)}function Es(){l(),ve.style.display="none";for(var s=0;s<ke.cross_points.length;s++)D(ke.cross_points[s][0],ke.cross_points[s][1],ke.cross_points[s][2]);for(var s=0;s<ke.dot_points.length;s++)z(ke.dot_points[s][0],ke.dot_points[s][1],ke.dot_points[s][2]);for(var s=0;s<ke.labels.length;s++)W(ke.labels[s][0],ke.labels[s][1],ke.labels[s][2],ke.labels[s][3]);for(var s=0;s<ke.solid_lines.length;s++)P(ke.solid_lines[s][0],ke.solid_lines[s][1],ke.solid_lines[s][2],ke.solid_lines[s][3],ke.solid_lines[s][4]);for(var s=0;s<ke.dashed_lines.length;s++)k(ke.dashed_lines[s][0],ke.dashed_lines[s][1],ke.dashed_lines[s][2],ke.dashed_lines[s][3],ke.dashed_lines[s][4]);for(var s=0;s<ke.heights.length;s++)P(ke.heights[s][0],ke.heights[s][1],ke.heights[s][2],ke.heights[s][3],ke.heights[s][16]),P(ke.heights[s][4],ke.heights[s][5],ke.heights[s][8],ke.heights[s][9],ke.heights[s][16]),P(ke.heights[s][6],ke.heights[s][7],ke.heights[s][8],ke.heights[s][9],ke.heights[s][16]);for(var s=0;s<ke.circles.length;s++)z(ke.circles[s][0],ke.circles[s][1],ke.circles[s][3]),J(ke.circles[s][0],ke.circles[s][1],ke.circles[s][2],0,2*Math.PI,!1,ke.circles[s][3]);for(var s=0;s<ke.compass.length;s++)if(ke.compass[s].length>0)for(var t=ke.compass[s][1][0],r=ke.compass[s][1][1],i=2;i<ke.compass[s].length;i++){var n=ke.compass[s][i][0],o=ke.compass[s][i][1];P(t,r,n,o,ke.compass[s][0]),t=n,r=o}if(ke.ruler.length>0){var a=ke.ruler[0],h=ke.ruler[1],t=ke.ruler[2],r=ke.ruler[3],c=Math.atan2(r-h,t-a);Ys.save(),Ys.translate(a,h),Ys.rotate(c),Ys.drawImage(be,0,0),Ys.restore()}if(ke.protr.length>0){var u=ke.protr[0],d=ke.protr[1],t=ke.protr[2],r=ke.protr[3],a=(u+t)/2,h=(d+r)/2,c=Math.atan2(r-h,t-a);Ys.save(),Ys.translate(a,h),Ys.rotate(c),Ys.drawImage(me,-136,-137),Ys.restore()}if(ke.select.length>0&&fs(ke.select),null!=e){for(var s=0;s<De.cross_points.length;s++)D(De.cross_points[s][0],De.cross_points[s][1],De.cross_points[s][2]);for(var s=0;s<De.dot_points.length;s++)z(De.dot_points[s][0],De.dot_points[s][1],De.dot_points[s][2]);for(var s=0;s<De.labels.length;s++)W(De.labels[s][0],De.labels[s][1],De.labels[s][2],De.labels[s][3]);for(var s=0;s<De.solid_lines.length;s++)P(De.solid_lines[s][0],De.solid_lines[s][1],De.solid_lines[s][2],De.solid_lines[s][3],De.solid_lines[s][4]);for(var s=0;s<De.dashed_lines.length;s++)k(De.dashed_lines[s][0],De.dashed_lines[s][1],De.dashed_lines[s][2],De.dashed_lines[s][3],De.dashed_lines[s][4]);for(var s=0;s<De.heights.length;s++)P(De.heights[s][0],De.heights[s][1],De.heights[s][2],De.heights[s][3],De.heights[s][16]),P(De.heights[s][4],De.heights[s][5],De.heights[s][8],De.heights[s][9],De.heights[s][16]),P(De.heights[s][6],De.heights[s][7],De.heights[s][8],De.heights[s][9],De.heights[s][16]);for(var s=0;s<De.circles.length;s++)z(De.circles[s][0],De.circles[s][1],De.circles[s][3]),J(De.circles[s][0],De.circles[s][1],De.circles[s][2],0,2*Math.PI,!1,De.circles[s][3]);for(var s=0;s<De.compass.length;s++)for(var t=De.compass[s][0][0],r=De.compass[s][0][1],i=1;i<De.compass[s].length;i++){var n=De.compass[s][i][0],o=De.compass[s][i][1];P(t,r,n,o,De.compass[s][0]),t=n,r=o}if(De.ruler.length>0){Ys.fillStyle="green";var t=De.ruler[0],r=De.ruler[1],n=De.ruler[2],o=De.ruler[3],_=De.ruler[4],p=De.ruler[5],g=De.ruler[6],y=De.ruler[7];P(t,r,n,o,"green"),P(t,r,_,p,"green"),P(n,o,g,y,"green"),P(_,p,g,y,"green");for(var s=1;s<5*Gs;s++){var f=t+(n-t)/(5*Gs)*s,v=(f-t)/(n-t)*(o-r)+r,m=-(v-r)/s+f,b=v+(n-t)/(5*Gs);s%5==0?(P(f,v,m,b),Ys.fillText(s/5,2*m-f,2*b-v)):P(f,v,(f+m)/2,(v+b)/2)}}if(De.protractor.length>0){var a=De.protractor[0],h=De.protractor[1],t=De.protractor[2],r=De.protractor[3],c=Math.atan2(r-h,t-a);Ys.save(),Ys.translate(a,h),Ys.rotate(c),Ys.drawImage(me,-136,-137),Ys.restore()}}}function As(s,e,t,l){var r=document.createElement("button");r.id=s.id+"-"+t.replace(" ","-"),r.className="geo2d-btn";var i=document.createElement("img");return i.src=e,r.appendChild(i),s.appendChild(r),r}function Fs(s,e,t){var l=document.createElement("select");l.style.width="109px",l.style.margin="5px",s.appendChild(l);for(var r=0;r<e.length;r++){var i=document.createElement("option");i.value=e[r],i.innerHTML=t[r],l.appendChild(i)}return l}function Ns(s,e,t){"geo2d-btn"!=s.className?(s.className="geo2d-btn",Cs([]),$.inArray("ruler",e)>-1&&(ke.ruler=[]),$.inArray("protr",e)>-1&&(ke.protr=[])):(Os(),s.className="geo2d-btn-onclick",null!=e&&Cs(e)),ke.select=[],Ws.style.cursor="default",Ms()}function Os(){for(var s=document.getElementsByClassName("geo2d-btn-onclick"),e=0;e<s.length;e++)s[e].className="geo2d-btn"}function Ts(){switch(caller){case"group":"0"==group_type?socket.emit("free-group-client-data",JSON.stringify({ws_id:qs,delta:JSON.stringify(Rs())})):socket.emit("assigned-group-client-data",JSON.stringify({g:g,w:w,q:q,ws_id:qs,delta:JSON.stringify(Rs())}));break;case"practice":socket.emit("practice-client-data",JSON.stringify({ws_id:qs,data:JSON.stringify(Rs())}));break;case"whiteboard":socket.emit("whiteboard-client-data",JSON.stringify({ws_id:qs,data:JSON.stringify(Rs())}))}}function Ls(s){s=JSON.parse(s),Gs=s.w,$s=s.h,Xs=s._,ke.cross_points=null!=s.x?s.x:[],ke.dot_points=null!=s.d?s.d:[],ke.solid_lines=null!=s.s?s.s:[],ke.dashed_lines=null!=s.i?s.i:[],ke.circles=null!=s.o?s.o:[],ke.compass=null!=s.v?s.v:[],ke.labels=null!=s.l?s.l:[],ke.heights=null!=s.hg?s.hg:[],ke.ruler=null!=s.r?s.r:[],ke.protr=null!=s.p?s.p:[],Se=null!=s.u?s.u:[]}function Rs(){var s={};return s.w=Gs,s.h=$s,s._=Xs,ke.cross_points=Ps(ke.cross_points),ke.cross_points.length>0&&(s.x=ke.cross_points),ke.dot_points=Ps(ke.dot_points),ke.dot_points.length>0&&(s.d=ke.dot_points),ke.solid_lines=Ps(ke.solid_lines),ke.solid_lines.length>0&&(s.s=ke.solid_lines),ke.dashed_lines=Ps(ke.dashed_lines),ke.dashed_lines.length>0&&(s.i=ke.dashed_lines),ke.circles=Ps(ke.circles),ke.circles.length>0&&(s.o=ke.circles),ke.compass=Ps(ke.compass),ke.compass.length>0&&(s.v=ke.compass),ke.labels=Ps(ke.labels),ke.labels.length>0&&(s.l=ke.labels),ke.heights=Ps(ke.heights),ke.heights.length>0&&(s.hg=ke.heights),ke.ruler.length>0&&(s.r=ke.ruler),ke.protr.length>0&&(s.p=ke.protr),s}function Ps(s){for(var e=0;e<s.length;e++)s[e].indexOf(-1)>-1&&s.splice(e--,1);return s}function ks(){return Le}function Ds(s){null!=s.c?(ws({}),Ks={}):null!=s.u?(null==Ks[s.u[0]]&&(Ks[s.u[0]]={}),Ks[s.u[0]][s.u]=s.u[2],zs(s.u[0])):null!=s.rt?(null!=Ks[s.rt]&&delete Ks[s.rt],ke[s.rt]=[]):null!=s.r&&null!=Ks[s.r[0]][s.r[1]]&&(delete Ks[s.r[0]][s.r[1]],zs(s.r[0])),Ms()}function zs(s){ke[s]=[];for(var e in Ks[s])Ks[s].hasOwnProperty(e)&&ke[s].push(Ks[s][e])}function Js(){var s=Ws.getBoundingClientRect();return event.pageX-s.left-$(window).scrollLeft()}function Us(){var s=Ws.getBoundingClientRect();return event.pageY-s.top-$(window).scrollTop()}var qs=s.id+"-geoshare",Ks={},js=!1,Gs=null!=e&&null!=e.w?parseInt(e.w):6,$s=null!=e&&null!=e.h?parseInt(e.h):6,Ws=document.createElement("canvas");Ws.id=s.id+"-canvas";var Ys=Ws.getContext("2d"),Hs=10,Xs=5*Hs;Ws.height=$s*Xs,Ws.width=Gs*Xs,s.appendChild(Ws);var Vs=null!=e&&null!=e.text_font?e.text_font:"15px verdana",Qs=U();s.appendChild(document.createElement("br"));var Zs=As(s,"src/core/img/line.png","Solid Line","top"),se=As(s,"src/core/img/dash.png","Dashed Line","top"),ee=As(s,"src/core/img/circle.png","Circle","top"),te=As(s,"src/core/img/cross.png","Crossed Point","top"),le=As(s,"src/core/img/dot.png","Dotted Point","top"),re=As(s,"src/core/img/label.png","Text Label","top"),ie=As(s,"src/core/img/height.png","Height","top");s.appendChild(document.createElement("br"));var ne=As(s,"src/core/img/compass.png","Compass","top"),oe=As(s,"src/core/img/protr_label.png","Protractor","bottom"),ae=As(s,"src/core/img/ruler.png","Ruler","bottom"),he=As(s,"src/core/img/select.png","Select","top"),ce=As(s,"src/core/img/del-passive.png","Delete","top"),ue=As(s,"src/core/img/copy-passive.png","Copy","top");s.appendChild(document.createElement("br"));var de=As(s,"src/core/img/undo-passive.png","Undo","left"),_e=As(s,"src/core/img/redo-passive.png","Redo","left"),pe=["none","solid_lines","dashed_lines","circles","cross_points","dot_points","compass","labels","ruler","protractor","all"],ge=["Clear","Solid Lines","Dashed Lines","Circles","Cross Points","Dotted Points","Compass","Labels","Ruler","Protractor","All"],ye=Fs(s,pe,ge);if("chrome"==Qs||"firefox"==Qs){var fe=document.createElement("input");fe.type="color",fe.style.margin="5px",fe.style.width="17px",s.appendChild(fe),fe.onchange=function(){xe=fe.value}}var ve=document.createElement("input");s.appendChild(ve),ve.style.display="none",ve.style.zIndex="99999";var me=document.createElement("img");me.src="src/core/img/protractor.png";var be=document.createElement("img");be.src="src/core/img/ruler-"+(Math.max(Gs,$s)-1)+".png";var xe="black",Me=[3,3],Ce=y1=x2=y2=null,we=oy=r=r2=r3=null,Be=5,Se=[],Ie=[],Ee=Hs,Ae=6*Hs,Fe=null,Ne=null,Oe=null,Te=null,Le=!1,Re=Math.max(Ws.height,Ws.width)/2,Pe={};Cs([]);var ke={},De={},ze={};return ws(t),Ss(e),null!=t&&""!=t&&Ls(t),0!=Se.length&&(de.firstChild.src="src/core/img/undo-active.png"),te.onmousedown=function(){Ns(this,["cross"],"<i>INSTRUCTIONS</i><br><br>Locate point > CLICK")},le.onmousedown=function(){Ns(this,["dot"],"<i>INSTRUCTIONS</i><br><br>Locate point > CLICK")},re.onmousedown=function(){Ns(this,["label"],"<i>INSTRUCTIONS</i><br><br>Locate label > CLICK<br>TYPE > <i>Enter</i>")},ie.onmousedown=function(){Ns(this,["height"],"<i>INSTRUCTIONS</i><br><br>PRESS > DRAG > RELEASE")},Zs.onmousedown=function(){Ns(this,["solid_line"],"<i>INSTRUCTIONS</i><br><br>PRESS > DRAG > RELEASE")},se.onmousedown=function(){Ns(this,["dashed_line"],"<i>INSTRUCTIONS</i><br><br>PRESS > DRAG > RELEASE")},ee.onmousedown=function(){Ns(this,["circle"],"<i>INSTRUCTIONS</i><br><br>Locate center<br>PRESS > DRAG > RELEASE")},ne.onmousedown=function(){Ns(this,["compass"],"<i>INSTRUCTIONS</i><br><br>Locate center > CLICK > RELEASE<br>MOVE for radius<br>PRESS > DRAG > RELEASE")},ae.onmousedown=function(){Ns(this,["ruler"],"<i>INSTRUCTIONS</i><br><br>Locate position > CLICK<br>Locate angle > CLICK")},oe.onmousedown=function(){Ns(this,["protr"],"<i>INSTRUCTIONS</i><br><br>Locate position > CLICK<br>Locate angle > CLICK")},de.onmousedown=function(){if(ke.select=[],Se.length>0){if(s=!1,0==Ie.length||"trans"!=Ie[Ie.length-1])var s=!0;var e=Se.pop();Ie.push(e);var t=ke[e].pop();if(ze[e].push(t),"trans"==e){if(s){var e=Se.pop();Ie.push(e);var t=ke[e].pop();ze[e].push(t)}bs(t,0,0,[])}else"del"==e&&bs(t,0,0,[]);Ms(),js&&Ts(),_e.firstChild.src="src/core/img/redo-active.png"}0==Se.length&&(de.firstChild.src="src/core/img/undo-passive.png"),Le=!0},_e.onmousedown=function(){if(ke.select=[],Ie.length>0){if(s=!1,0==Se.length||"trans"!=Se[Se.length-1])var s=!0;var e=Ie.pop();Se.push(e);var t=ze[e].pop();if(ke[e].push(t),"trans"==e){if(s){var e=Ie.pop();Se.push(e);var t=ze[e].pop();ke[e].push(t)}bs(t,0,0,[])}else"del"==e&&bs(t,null,null,null);Ms(),js&&Ts(),de.firstChild.src="src/core/img/undo-active.png"}0==Ie.length&&(_e.firstChild.src="src/core/img/redo-passive.png"),Le=!0},ye.onchange=function(){if("all"==this.options[this.selectedIndex].value){var s=confirm("Are you sure you want to reset everything?");s&&ws({})}else Is(this.options[this.selectedIndex].value);Os(),this.selectedIndex=0,Cs([]),Ms(),js&&Ts(),0==Se.length&&(de.firstChild.src="src/core/img/undo-passive.png"),Le=!0},he.onmousedown=function(){Ns(this,["select"],"<i>INSTRUCTIONS</i><br><br>DRAG TO SELECT")},ce.onmousedown=function(){null!=Te&&(bs(Te,null,null,null),this.firstChild.src="src/core/img/del-passive.png",ue.firstChild.src="src/core/img/copy-passive.png",ke.del.push(Te),Se.push("del"),ke.select=[],Ws.style.cursor="default",Cs([]),Os(),Ms())},ue.onmousedown=function(){null!=Te&&(ms(Te,ke.select),ce.firstChild.src="src/core/img/del-passive.png",this.firstChild.src="src/core/img/copy-passive.png",ke.select=[],Ws.style.cursor="default",Cs([]),Os(),Ms())},mouse_down_handler=function(s){s.preventDefault(),Pe.cross||i(s),Pe.dot||n(s),Pe.solid_line||a(s),Pe.dashed_line||u(s),Pe.height||p(s),Pe.circle||v(s),Pe.ruler||I(s),Pe.compass||x(s),Pe.protr||F(s),Pe.label||o(s),Pe.select||T(s),js&&Ts()},mouse_move_handler=function(s){s.preventDefault(),Pe.solid_line_move||h(s),Pe.dashed_line_move||d(s),Pe.height_move||y(s),Pe.circle||m(s),Pe.ruler||E(s),Pe.protr||N(s),!Pe.compass&&Pe.compass_rad&&Pe.compass_draw&&M(s),Pe.compass_rad||C(s),Pe.compass_draw||B(s),Pe.select||L(s)},mouse_up_handler=function(s){s.preventDefault(),Pe.solid_line||c(s),Pe.dashed_line||_(s),Pe.height||f(s),Pe.circle||b(s),Pe.compass||S(s),Pe.ruler||A(s),Pe.protr||O(s),Pe.select||R(s),js&&Ts()},Object.size=function(s){var e,t=0;for(e in s)s.hasOwnProperty(e)&&t++;return t},Es(),{status:function(){return JSON.stringify(Rs())},modified:function(){return ks()},restore:function(s){""!=s&&(Ls(s),Ms())},node_pull:function(s){console.log(s)},node_pull_delta:function(s){Ds(s)},switch_emitable:function(s){js=s},getType:function(){return"geo2d"},getID:function(){return ws_id},debug:function(){}}};